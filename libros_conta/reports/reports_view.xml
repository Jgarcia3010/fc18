<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>
        <record id="search_libro_ventas" model="ir.ui.view">
            <field name="name">libros_conta.search_libros</field>
            <field name="model">account.invoice.libroventas</field>
            <field name="arch" type="xml">
                <search string="Invoices Analysis">
                    <filter string="Facturas" name="invoice" domain="['|', ('move_type','=','out_invoice'),('move_type','=','in_invoice')]"/>
                    <filter string="Notas de Crédito" name="creditnote" domain="['|', ('move_type','=','out_refund'),('move_type','=','in_refund')]"/>
                    <separator/>
                    <filter name="date" date="date"/>
                    <field name="partner_id" operator="child_of"/>
                    <group expand="1" string="Group By">
                        <filter string="Partner" name="partner_id" context="{'group_by':'partner_id','residual_visible':True}"/>
                        <filter string="Company" name="company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                        <separator orientation="vertical" />
                        <filter string="Date" name="month" context="{'group_by':'date:month'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="search_libro_compras" model="ir.ui.view">
            <field name="name">libros_conta.search_libros</field>
            <field name="model">account.invoice.librocompras</field>
            <field name="arch" type="xml">
                <search string="Invoices Analysis">
                    <filter string="Facturas" name="invoice" domain="['|', ('move_type','=','out_invoice'),('move_type','=','in_invoice')]"/>
                    <filter string="Notas de Crédito" name="creditnote" domain="['|', ('move_type','=','out_refund'),('move_type','=','in_refund')]"/>
                    <separator/>
                    <filter name="date" date="filter_date"/>
                    <field name="partner_id" operator="child_of"/>
                    <group expand="1" string="Group By">
                        <filter string="Partner" name="partner_id" context="{'group_by':'partner_id','residual_visible':True}"/>
                        <filter string="Company" name="company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                        <separator orientation="vertical" />
                        <filter string="Date" name="month" context="{'group_by':'filter_date:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_account_invoice_libroventas_form" model="ir.ui.view">
            <field name="name">account.invoice.libroventas.form</field>
            <field name="model">account.invoice.libroventas</field>
            <field name="arch" type="xml">
              <form create="false" edit="false"><sheet><group col="4">
                    <field name="vat" />
                    <field name="partner_id" />
                    <field name="move_id" />
                    <field name="serie" />
                    <field name="factura" />
                    <field name="date" />
                    <field name="move_type" />
                    <field name="mbase" sum="mbase"/>
                    <field name="mimpuestos" sum="mimpuestos"/>
                    <field name="sbase" sum="sbase"/>
                    <field name="simpuestos" sum="simpuestos"/>
                    <field name="exportation" />
                    <field name="total" />
              </group></sheet></form>
            </field>
        </record>
        <record id="view_account_invoice_libroventas_tree" model="ir.ui.view">
            <field name="name">account.invoice.libroventas.tree</field>
            <field name="model">account.invoice.libroventas</field>
            <field name="arch" type="xml">
                <list create="false" edit="false" sample="1" js_class="libros_list_view">
                    <field name="vat" />
                    <field name="partner_id" />
                    <field name="move_id" />
                    <field name="serie" />
                    <field name="factura" />
                    <field name="date" />
                    <field name="move_type" />
                    <field name="mbase" sum="mbase"/>
                    <field name="mimpuestos" sum="mimpuestos"/>
                    <field name="sbase" sum="sbase"/>
                    <field name="simpuestos" sum="simpuestos"/>
                    <field name="exportation" />
                    <field name="total" />
                </list>
            </field>
        </record>

        <record id="view_account_invoice_librocompras_form" model="ir.ui.view">
            <field name="name">account.invoice.librocompras.form</field>
            <field name="model">account.invoice.librocompras</field>
            <field name="arch" type="xml">
              <form create="false" edit="false"><sheet><group col="4">
                    <field name="move_id" />
                    <field name="vat" />
                    <field name="partner_id" />
                    <field name="move_type" />
                    <field name="serie" />
                    <field name="factura" />
                    <field name="date" />
                    <field name="filter_date" invisible="1" />
                    <field name="mbase" sum="mbase"/>
                    <field name="mimpuestos" sum="mimpuestos"/>
                    <field name="sbase" sum="sbase"/>
                    <field name="simpuestos" sum="simpuestos"/>
                    <field name="mpcbase" sum="mpcbase"/>
                    <field name="mpcimpuestos" sum="mpcimpuestos"/>
                    <field name="spcbase" sum="spcbase"/>
                    <field name="spcimpuestos" sum="spcimpuestos"/>
                    <field name="importation" />
                    <field name="total" />
              </group></sheet></form>
            </field>
        </record>
        <record id="view_account_invoice_librocompras_tree" model="ir.ui.view">
            <field name="name">account.invoice.librocompras.tree</field>
            <field name="model">account.invoice.librocompras</field>
            <field name="arch" type="xml">
                <list string="Líneas" create="false" edit="false" sample="1"  js_class="libros_list_view">
                    <field name="move_id" />
                    <field name="vat" />
                    <field name="partner_id" />
                    <field name="move_type" />
                    <field name="serie" />
                    <field name="factura" />
                    <field name="date" />
                    <field name="filter_date" invisible="1" />
                    <field name="mbase" sum="mbase"/>
                    <field name="mimpuestos" sum="mimpuestos"/>
                    <field name="sbase" sum="sbase"/>
                    <field name="simpuestos" sum="simpuestos"/>
                    <field name="mpcbase" sum="mpcbase"/>
                    <field name="mpcimpuestos" sum="mpcimpuestos"/>
                    <field name="spcbase" sum="spcbase"/>
                    <field name="spcimpuestos" sum="spcimpuestos"/>
                    <field name="importation" />
                    <field name="total" />
                </list>
            </field>
        </record>

        <record id="libro_ventas_action" model="ir.actions.act_window">
            <field name="name">Libro de Ventas</field>
            <field name="res_model">account.invoice.libroventas</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help">Libro de ventas.</field>
            <field name="search_view_id" ref="libros_conta.search_libro_ventas" />
        </record>
        <record id="libro_compras_action" model="ir.actions.act_window">
            <field name="name">Libro de Compras</field>
            <field name="res_model">account.invoice.librocompras</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help">Libro de compras.</field>
            <field name="search_view_id" ref="libros_conta.search_libro_compras" />
        </record>

        <!-- <menuitem id="account_reports_contabilidad_menu" name="Contabilidad" parent="account.menu_finance_reports" sequence="4">
            <menuitem id="libro_de_ventas_menu" name="Libro de Ventas" sequence="10" action="libros_conta.libro_ventas_action"/>
            <menuitem id="libro_de_compras_menu" name="Libro de Compras" sequence="10" action="libros_conta.libro_compras_action"/>
        </menuitem> -->



        <template id="libro_template_compras">

            <t t-call="web.html_container">
              <t t-call="web.report_layout">

                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/>
                    </t>
                    <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                        <t t-set="company" t-value="o.company_id.sudo()"/>
                    </t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/>
                    </t>
                </t>

                <t t-set="docs" t-value="env['account.invoice.librocompras'].search(domain)"/>


                <div class="page article">
                    <style type="text/css">

                      body {
                          font-size: 10px;
                      }
                      table {
                          width: 100%;
                          margin-top: 4in;
                      }
                      table tbody tr td {
                          border: 0.005in solid #aaaaaa;
                          padding: 0px 5px;
                      }
                      table th {
                          border: 0.005in solid #aaaaaa;
                          padding: 3px 5px;
                          font-weight: bold;
                      }
                      tr:nth-child(even) {background: #eeeeee}
                      tr:nth-child(odd) {background: white}

                      tr.totales td {
                          font-weight: bold;
                      }
                      .right-aligned{
                        text-align: right;
                      }
                    </style>
                    <div t-attf-class="o_company_#{company.id}_layout header" t-att-style="report_header_style">
                        <div class="o_background_header">
                            <div class="float-right">
                              <h3 class="mt0 text-right">Libro de compras</h3>
                            </div>
                            <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" class="float-left" alt="Logo" style="height: 60px;"/>
                            <div class="float-left company-name" style="width: 400px; padding-top: 10px; font-size: 20px;">
                                <div>
                                    <strong t-field="company.partner_id.name"/>
                                </div>
                            </div>
                            <div class="float-left">
                                <div t-if="daterange[0]">
                                  Desde <span t-esc="daterange[0]"/>
                                </div>
                                <div t-if="daterange[1]">
                                  Hasta <span t-esc="daterange[1]"/>
                                </div>
                            </div>
                          </div>
                    </div>
                    <table>
                      <thead>
                        <tr>
                          <th t-foreach="columns" t-as="col">
                            <span t-esc="col" />
                          </th>
                          <th>
                            Importaciones
                          </th>
                          <th>
                            Total
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                      <t t-set="total_import" t-value="0" />
                        <t t-set="total_global" t-value="0" />
                        <tr t-foreach="docs" t-as="row">
                          <td>
                            <span t-field="row.vat" />
                          </td><td>
                            <span t-field="row.partner_id" />
                          </td><td>
                            <span t-field="row.move_id" />
                          </td><td>
                            <span t-field="row.move_type" />
                          </td><td>
                            <span t-field="row.serie" />
                          </td><td>
                            <span t-field="row.factura" />
                          </td><td>
                            <span t-field="row.date" />
                          </td><td class="right-aligned">
                            <span t-field="row.mbase"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.mimpuestos"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.sbase"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.simpuestos"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.mpcbase" t-options='{"widget": "float", "precision": 2}'  />
                          </td><td class="right-aligned">
                            <span t-field="row.mpcimpuestos" t-options='{"widget": "float", "precision": 2}'  />
                          </td><td class="right-aligned">
                            <span t-field="row.spcbase" t-options='{"widget": "float", "precision": 2}'  />
                          </td><td class="right-aligned">
                            <span t-field="row.spcimpuestos"  t-options='{"widget": "float", "precision": 2}'  />
                          </td>
                          <td class="right-aligned">
                          <t t-set="total_import" t-value="total_import + row.importation" />
                            <span t-esc="row.importation" t-options='{"widget": "float", "precision": 2}' />
                          </td>
                          <td class="right-aligned">
                            <t t-set="row_total" t-value="row.mbase + row.mimpuestos + row.sbase + row.simpuestos + row.mpcbase + row.mpcimpuestos + row.spcbase + row.spcimpuestos"/>
                            <t t-set="total_global" t-value="total_global + row_total" />
                            <span t-esc="row_total"  t-options='{"widget": "float", "precision": 2}' />
                          </td>
                        </tr>
                        <tr class="totales">
                          <td t-foreach="sums" t-as="isum">
                            <span t-if="isum != None"><span t-esc="isum" t-options='{"widget": "float", "precision": 2}' /></span>
                          </td>
                          <td class="right-aligned">
                            <span t-esc="total_import" t-options='{"widget": "float", "precision": 2}'/>
                          </td>
                          <td class="right-aligned">
                            <span t-esc="total_global" t-options='{"widget": "float", "precision": 2}'/>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
                        <div class="text-center" style="border-top: 1px solid black;">
                            <ul class="list-inline mb4">
                                <li t-if="company.website" class="list-inline-item d-inline"><span t-field="company.website"/></li>
                                <li t-if="company.vat" class="list-inline-item d-inline">NIT: <span t-field="company.vat"/></li>
                            </ul>

                            <div t-if="report_type == 'pdf'" class="text-muted">
                                Pág. <span class="page"/> / <span class="topage"/> - Fecha y hora:  <span t-esc=" context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M') "/>
                            </div>
                        </div>
                  </div>
                </div>
              </t>
            </t>
        </template>

        <template id="libro_template_ventas">

            <t t-call="web.html_container">
              <t t-call="web.report_layout">

                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/>
                    </t>
                    <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                        <t t-set="company" t-value="o.company_id.sudo()"/>
                    </t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/>
                    </t>
                </t>

                <t t-set="docs" t-value="env['account.invoice.libroventas'].search(domain)"/>


                <div class="page article">
                    <style type="text/css">

                      body {
                          font-size: 10px;
                      }
                      table {
                          width: 100%;
                          margin-top: 4in;
                      }
                      table tbody tr td {
                          border: 0.005in solid #aaaaaa;
                          padding: 0px 5px;
                      }
                      table th {
                          border: 0.005in solid #aaaaaa;
                          padding: 3px 5px;
                          font-weight: bold;
                      }
                      tr:nth-child(even) {background: #eeeeee}
                      tr:nth-child(odd) {background: white}

                      tr.totales td {
                          font-weight: bold;
                      }

                      .right-aligned{
                        text-align: right;
                      }
                    </style>
                    <div t-attf-class="o_company_#{company.id}_layout header" t-att-style="report_header_style">
                        <div class="o_background_header">
                            <div class="float-right">
                              <h3 class="mt0 text-right">Libro de ventas</h3>
                            </div>
                            <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" class="float-left" alt="Logo" style="height: 60px;"/>
                            <div class="float-left company-name" style="width: 400px; padding-top: 10px; font-size: 20px;">
                                <div>
                                    <strong t-field="company.partner_id.name"/>
                                </div>
                            </div>
                            <div class="float-left">
                                <div t-if="daterange[0]">
                                  Desde <span t-esc="daterange[0]"/>
                                </div>
                                <div t-if="daterange[1]">
                                  Hasta <span t-esc="daterange[1]"/>
                                </div>
                            </div>
                          </div>
                    </div>
                    <table>
                      <thead>
                        <tr>
                          <th t-foreach="columns" t-as="col">
                            <span t-esc="col" />
                          </th>
                          <th>
                            Exportaciones
                          </th>
                          <th>
                            Total
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <t t-set="total_export" t-value="0" />
                        <t t-set="total_global" t-value="0" />
                        <tr t-foreach="docs" t-as="row">
                          <td>
                            <span t-field="row.vat" />
                          </td><td>
                            <span t-field="row.partner_id" />
                          </td><td>
                            <span t-field="row.move_id" />
                          </td><td>
                            <span t-field="row.serie" />
                          </td><td>
                            <span t-field="row.factura" />
                          </td><td>
                            <span t-field="row.date" />
                          </td><td>
                            <span t-field="row.move_type" />
                          </td><td class="right-aligned">
                            <span t-field="row.mbase"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.mimpuestos"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.sbase"  t-options='{"widget": "float", "precision": 2}' />
                          </td><td class="right-aligned">
                            <span t-field="row.simpuestos"  t-options='{"widget": "float", "precision": 2}' />
                          </td>
                          <td class="right-aligned">
                            <t t-set="total_export" t-value="total_export + row.exportation" />
                            <span t-esc="row.exportation" t-options='{"widget": "float", "precision": 2}' />
                          </td>
                          <td class="right-aligned">
                            <t t-set="row_total" t-value="row.mbase + row.mimpuestos + row.sbase + row.simpuestos"/>
                            <t t-set="total_global" t-value="total_global + row_total" />
                            <span t-esc="row_total"  t-options='{"widget": "float", "precision": 2}' />
                          </td>
                        </tr>
                        <tr class="totales">
                          <td t-foreach="sums" t-as="isum"  class="right-aligned">
                            <span t-if="isum != None"><span t-esc="isum" t-options='{"widget": "float", "precision": 2}' /></span>
                          </td>
                          <td class="right-aligned">
                            <span t-esc="total_export" t-options='{"widget": "float", "precision": 2}'/>
                          </td>
                          <td class="right-aligned">
                            <span t-esc="total_global" t-options='{"widget": "float", "precision": 2}'/>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
                        <div class="text-center" style="border-top: 1px solid black;">
                            <ul class="list-inline mb4">
                                <li t-if="company.website" class="list-inline-item d-inline"><span t-field="company.website"/></li>
                                <li t-if="company.vat" class="list-inline-item d-inline">NIT: <span t-field="company.vat"/></li>
                            </ul>

                            <div t-if="report_type == 'pdf'" class="text-muted">
                                Pág. <span class="page"/> / <span class="topage"/> - Fecha y hora:  <span t-esc=" context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M') "/>
                            </div>
                        </div>
                  </div>
                </div>
              </t>
            </t>
        </template>


        <record id="search_costos" model="ir.ui.view">
            <field name="name">libros_conta.search_costos</field>
            <field name="model">libros_conta.costos</field>
            <field name="arch" type="xml">
                <search string="Buscar Costos">
                    <filter name="fecha" date="fecha"/>
                    <field name="partner" string="Proveedor" operator="child_of"/>
                    <field string="Proyecto" name="analytic_account" />
                    <group expand="1" string="Group By">
                        <filter string="Proveedor" name="partner" context="{'group_by':'partner','residual_visible':True}" />
                        <filter string="Mes" name="month" context="{'group_by':'fecha:month'}" />
                        <filter string="Proyecto" name="analytic_account" context="{'group_by':'analytic_account','residual_visible':True}" />
                    </group>
                </search>
            </field>
        </record>
        <record id="view_libros_conta_costos_form" model="ir.ui.view">
            <field name="name">libros_conta.costos.form</field>
            <field name="model">libros_conta.costos</field>
            <field name="arch" type="xml">
              <form create="false" edit="false"><sheet><group col="4">
                <field name="analytic_account" />
                <field name="order_id" />
                <field name="move" string="Caja chica" />
                <field name="user_id" />
                <field name="partner" />
                <field name="vat" />
                <field name="fecha" />
                <field name="product" />
                <field name="description" />
                <field name="quantity" />
                <field name="unitprice" />
                <field name="total" sum="total"/>
              </group></sheet></form>
            </field>
        </record>
        <record id="view_libros_conta_costos_tree" model="ir.ui.view">
            <field name="name">libros_conta.costos.tree</field>
            <field name="model">libros_conta.costos</field>
            <field name="arch" type="xml">
              <list create="false" edit="false">
                <field name="analytic_account" />
                <field name="order_id" />
                <field name="move" string="Caja chica" />
                <field name="user_id" />
                <field name="partner" />
                <field name="vat" />
                <field name="fecha" />
                <field name="product" />
                <field name="description" />
                <field name="quantity" />
                <field name="unitprice" />
                <field name="total" sum="total"/>
              </list>
            </field>
        </record>
        <record id="costos_action" model="ir.actions.act_window">
            <field name="name">Costos (orden de compra)</field>
            <field name="res_model">libros_conta.costos</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help">Costos (orden de compra)</field>
            <field name="search_view_id" ref="libros_conta.search_costos" />
        </record>
        <menuitem id="libro_costos_menu" name="Costos (orden de compra)" sequence="14" action="libros_conta.costos_action" parent="account.menu_finance_reports" />

        <record id="view_libros_conta_costos_facturas_form" model="ir.ui.view">
            <field name="name">libros_conta.costos_facturas.form</field>
            <field name="model">libros_conta.costos_facturas</field>
            <field name="arch" type="xml">
              <form create="false" edit="false"><sheet><group col="4">
                <field name="analytic_account" />
                <field name="move" string="Caja chica" />
                <field name="partner" />
                <field name="vat" />
                <field name="fecha" />
                <field name="product" />
                <field name="description" />
                <field name="quantity" />
                <field name="unitprice" />
                <field name="total" sum="total"/>
              </group></sheet></form>
            </field>
        </record>
        <record id="view_libros_conta_costos_facturas_tree" model="ir.ui.view">
            <field name="name">libros_conta.costos_facturas.tree</field>
            <field name="model">libros_conta.costos_facturas</field>
            <field name="arch" type="xml">
              <list create="false" edit="false">
                <field name="analytic_account" />
                <field name="move" string="Caja chica" />
                <field name="partner" />
                <field name="vat" />
                <field name="fecha" />
                <field name="product" />
                <field name="description" />
                <field name="quantity" />
                <field name="unitprice" />
                <field name="total" sum="total"/>
              </list>
            </field>
        </record>
        <record id="costos_facturas_action" model="ir.actions.act_window">
            <field name="name">Costos (factura)</field>
            <field name="res_model">libros_conta.costos_facturas</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help">Costos (factura)</field>
            <field name="search_view_id" ref="libros_conta.search_costos" />
        </record>
        <menuitem id="libro_costos_facturas_menu" name="Costos (factura)" sequence="15" action="libros_conta.costos_facturas_action" parent="account.menu_finance_reports" />

    </data>
</openerp>
